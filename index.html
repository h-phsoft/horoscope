<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…ÙÙˆÙ„Ø¯ â€” Ø§Ù„Ù…ÙˆÙ„Ø¯ Ø§Ù„ÙÙ„ÙƒÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: #e0e0e0;
      display: grid;
      grid-template-columns: 280px 1fr 280px;
      grid-template-rows: auto 1fr auto;
      min-height: 100vh;
      gap: 1px;
    }
    header {
      grid-column: 1 / -1;
      background: #1e1e1e;
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid #444;
    }
    #sidebar-left, #main, #sidebar-right {
      padding: 15px;
      overflow-y: auto;
    }
    #sidebar-left {
      background: #1e1e1e;
    }
    #main {
      background: #16213e;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    #sidebar-right {
      background: #222;
      font-size: 14px;
      line-height: 1.6;
    }
    .drop-zone {
      border: 3px dashed #0077b6;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      margin: 10px 0;
      background: #1a1a2e;
      color: #00b4d8;
    }
    .input-group {
      margin: 12px 0;
      font-size: 15px;
    }
    label {
      display: block;
      text-align: right;
      margin-bottom: 6px;
    }
    input, select, button {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #333;
      color: #fff;
    }
    button {
      background: #0077b6;
      color: white;
      font-weight: bold;
      cursor: pointer;
      margin: 8px 0;
    }
    .btn-print { background: #00b4d8; }
    .btn-save { background: #90e0ef; color: #003060; }
    .info-panel {
      margin: 15px 0;
      padding: 12px;
      background: #2a2a2a;
      border-radius: 8px;
      font-size: 13px;
    }
    .legend-item {
      margin: 4px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .symbol {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }
    canvas {
      margin: 10px;
      background: #1a1a2e;
      border: 1px solid #0077b6;
      border-radius: 50%;
      max-height: 90vh;
      height: 90vh;
      width: auto;
    }
    .tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 8px;
      border-radius: 6px;
      font-size: 14px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 10;
      transform: translate(-50%, -100%);
    }
    .footer {
      grid-column: 1 / -1;
      background: #1e1e1e;
      padding: 10px;
      text-align: center;
      font-size: 12px;
      color: #888;
    }
    .legend-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .legend-col {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .legend-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Modal */
    #analysisModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    #analysisModalContent {
      background: #1e1e1e;
      color: #e0e0e0;
      width: 90%;
      max-width: 700px;
      padding: 25px;
      border-radius: 14px;
      max-height: 85vh;
      overflow-y: auto;
      line-height: 1.7;
    }
    #analysisModal h2 {
      color: #00b4d8;
      margin-bottom: 15px;
    }
    #analysisModal h3 {
      color: #0077b6;
      margin: 18px 0 10px 0;
      font-size: 18px;
    }
    #closeModalBtn {
      margin-top: 20px;
      background: #0077b6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <h1>Ù…ÙÙˆÙ„Ø¯ â€” Ø§Ù„Ù…ÙˆÙ„Ø¯ Ø§Ù„ÙÙ„ÙƒÙŠ</h1>
  </header>

  <div id="sidebar-left">
    <div class="input-group">
      <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
      <input type="date" id="birthDate" />
    </div>
    <div class="input-group">
      <label>Ø§Ù„ÙˆÙ‚Øª (24 Ø³Ø§Ø¹Ø©):</label>
      <input type="time" id="birthTime" step="1" />
    </div>
    <div class="input-group">
      <label>Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶:</label>
      <input type="number" id="latitude" step="0.0001" value="30.0444" />
    </div>
    <div class="input-group">
      <label>Ø®Ø· Ø§Ù„Ø·ÙˆÙ„:</label>
      <input type="number" id="longitude" step="0.0001" value="31.2357" />
    </div>
    <button onclick="generateChart()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø®Ø·Ø·</button>
    <button class="btn-print" onclick="printReport()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    <button class="btn-save" onclick="saveReport('txt')">ğŸ’¾ Ø­ÙØ¸ ÙƒÙ†Øµ</button>
    <button class="btn-save" onclick="saveReport('pdf')">ğŸ“„ Ø­ÙØ¸ ÙƒÙ€ PDF</button>
    <button id="btnAnalysis" onclick="showPersonalityAnalysis()" style="display:none;">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ©</button>

    <h3>Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª</h3>
    <div id="dropZone" class="drop-zone">
      <p>Ø§Ø³Ø­Ø¨ Ù…Ù„Ù Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ù‡Ù†Ø§</p>
      <small>ÙŠØ¯Ø¹Ù…: .txt, .json</small>
    </div>

    <div class="info-panel" id="infoPanel">
      LST: --Â° | Ø§Ù„ØµØ§Ø¹Ø¯: --Â° | MC: --Â°
    </div>

    <h3>Ø§Ù„ÙƒÙˆØ§ÙƒØ¨:</h3>
    <div id="planetsLegend"></div>
  </div>

  <div id="main">
    <canvas id="horoscope" width="600" height="600"></canvas>
    <div id="tooltip" class="tooltip">Ø¨ÙŠØª 1</div>
  </div>

  <div id="sidebar-right">
    <h2>Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ„ÙƒÙŠ</h2>
    <div id="analysisContent">
      <p>Ø§Ø¶ØºØ· "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø®Ø·Ø·" Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ù„ÙŠÙ„.</p>
    </div>

    <h3>Ø§Ù„Ø¯Ù„ÙŠÙ„: Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ ÙˆØ§Ù„Ø£Ø¨Ø±Ø§Ø¬</h3>
    <div class="legend-grid">
      <div class="legend-col" id="planetsGuide"></div>
      <div class="legend-col" id="signsGuide"></div>
    </div>

    <h3>Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
    <div>
      <div class="aspect-line" style="background: gold; height:12px; margin:2px 0; border-radius:3px;"></div><small>Ø§Ù‚ØªØ±Ø§Ù† (0Â°)</small><br>
      <div class="aspect-line" style="background: green; height:12px; margin:2px 0; border-radius:3px;"></div><small>Ø³Ø¯Ø§Ø³ÙŠ (60Â°)</small><br>
      <div class="aspect-line" style="background: blue; height:12px; margin:2px 0; border-radius:3px;"></div><small>ØªØ«Ù„ÙŠØ« (120Â°)</small><br>
      <div class="aspect-line" style="background: red; height:12px; margin:2px 0; border-radius:3px;"></div><small>ØªØ±Ø¨ÙŠØ¹ (90Â°)</small><br>
      <div class="aspect-line" style="background: purple; height:12px; margin:2px 0; border-radius:3px;"></div><small>ØªÙ‚Ø§Ø¨Ù„ (180Â°)</small>
    </div>

    <h3>Ø§Ù„Ø±Ù…ÙˆØ²</h3>
    <div>
      <p><strong>â†‘</strong>: Ø§Ù„ØµØ§Ø¹Ø¯ (Ascendant) - Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØª Ø§Ù„Ø£ÙˆÙ„</p>
      <p><strong>âŠ•</strong>: Ø§Ù„Ù‚Ù…Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© (MC) - Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØª 10</p>
    </div>
  </div>

  <div class="footer">
    Ù…ÙˆÙ„Ø¯ ÙÙ„ÙƒÙŠ Ø¯Ù‚ÙŠÙ‚ â€” Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª â€” ÙŠÙ…ÙƒÙ† ØªØ«Ø¨ÙŠØªÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ â€” Ø¥ØµØ¯Ø§Ø± 1.25.09.2506
  </div>

  <!-- Modal -->
  <div id="analysisModal">
    <div id="analysisModalContent">
      <h2>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„ÙÙ„ÙƒÙŠ</h2>
      <div id="personalityContent"></div>
      <button id="closeModalBtn" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <script>
    // --- Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ù† Ù…ÙˆÙ‚Ø¹Ùƒ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ÙƒÙ„ Ø´ÙŠØ¡ ---
    const canvas = document.getElementById('horoscope');
    const ctx = canvas.getContext('2d');
    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    const radius = 200;
    const tooltip = document.getElementById('tooltip');

    let currentData = null;

    function degToRad(d) { return d * Math.PI / 180; }
    function radToDeg(r) { return r * 180 / Math.PI; }
    function mod(n, m) { return ((n % m) + m) % m; }

    function julianDay(date) {
      const y = date.getFullYear();
      const m = date.getMonth() + 1;
      const d = date.getDate();
      const h = date.getHours() + date.getMinutes() / 60 + date.getSeconds() / 3600;
      const a = Math.floor((14 - m) / 12);
      const yAdj = y + 4800 - a;
      const mAdj = m + 12 * a - 3;
      let jd = d + Math.floor((153 * mAdj + 2) / 5) + 365 * yAdj +
               Math.floor(yAdj / 4) - Math.floor(yAdj / 100) +
               Math.floor(yAdj / 400) - 32045;
      return jd + (h / 24) - 0.5;
    }

    function gmst(jd) {
      const D = jd - 2451545.0;
      let gmst = 18.697374558 + 24.06570982441908 * D;
      gmst = gmst % 24;
      if (gmst < 0) gmst += 24;
      return gmst * 15;
    }

    function localSiderealTime(jd, lon) {
      return mod(gmst(jd) + lon, 360);
    }

    function calculateAscendant(lst, lat) {
      const ecl = 23.44;
      const A = -Math.sin(degToRad(lst));
      const B = Math.cos(degToRad(lst)) * Math.sin(degToRad(lat)) + Math.tan(degToRad(ecl)) * Math.cos(degToRad(lat));
      let asc = radToDeg(Math.atan2(A, B));
      return mod(asc, 360);
    }

    function calculateMC(lst) {
      const ecl = 23.44;
      const mc = radToDeg(Math.atan(Math.sin(degToRad(lst)) / Math.tan(degToRad(ecl))));
      return mod(mc, 360);
    }

    function equalHouses(asc) {
      return Array.from({ length: 12 }, (_, i) => mod(asc + i * 30, 360));
    }

    const planets = [
      { name: 'Ø´Ù…Ø³', symbol: 'â˜‰', color: 'yellow', eng: 'Sun' },
      { name: 'Ù‚Ù…Ø±', symbol: 'â˜½', color: 'white', eng: 'Moon' },
      { name: 'Ø¹Ø·Ø§Ø±Ø¯', symbol: 'â˜¿', color: '#ccc', eng: 'Mercury' },
      { name: 'Ø§Ù„Ø²Ù‡Ø±Ø©', symbol: 'â™€', color: 'pink', eng: 'Venus' },
      { name: 'Ø§Ù„Ù…Ø±ÙŠØ®', symbol: 'â™‚', color: 'red', eng: 'Mars' },
      { name: 'Ø§Ù„Ù…Ø´ØªØ±ÙŠ', symbol: 'â™ƒ', color: '#ffa500', eng: 'Jupiter' },
      { name: 'Ø²Ø­Ù„', symbol: 'â™„', color: '#daa520', eng: 'Saturn' },
      { name: 'Ø£ÙˆØ±Ø§Ù†ÙˆØ³', symbol: 'â™…', color: '#00ffff', eng: 'Uranus' },
      { name: 'Ù†Ø¨ØªÙˆÙ†', symbol: 'â™†', color: '#1e90ff', eng: 'Neptune' },
      { name: 'Ø¨Ù„ÙˆØªÙˆ', symbol: 'â™‡', color: '#b8860b', eng: 'Pluto' }
    ];

    const zodiac = [
      { name: 'Ø­Ù…Ù„', symbol: 'â™ˆ', color: '#ff6b35' },
      { name: 'Ø«ÙˆØ±', symbol: 'â™‰', color: '#8bc34a' },
      { name: 'Ø¬ÙˆØ²Ø§Ø¡', symbol: 'â™Š', color: '#00b4d8' },
      { name: 'Ø³Ø±Ø·Ø§Ù†', symbol: 'â™‹', color: '#0077b6' },
      { name: 'Ø£Ø³Ø¯', symbol: 'â™Œ', color: '#ff9800' },
      { name: 'Ø¹Ø°Ø±Ø§Ø¡', symbol: 'â™', color: '#9c27b0' },
      { name: 'Ù…ÙŠØ²Ø§Ù†', symbol: 'â™', color: '#3f51b5' },
      { name: 'Ø¹Ù‚Ø±Ø¨', symbol: 'â™', color: '#f44336' },
      { name: 'Ù‚ÙˆØ³', symbol: 'â™', color: '#795548' },
      { name: 'Ø¬Ø¯ÙŠ', symbol: 'â™‘', color: '#607d8b' },
      { name: 'Ø¯Ù„Ùˆ', symbol: 'â™’', color: '#2196f3' },
      { name: 'Ø­ÙˆØª', symbol: 'â™“', color: '#e91e63' }
    ];

    function planetLong(name, jd) {
      const n = jd - 2451545.0;
      const orbits = {
        Sun: mod(280.466 + 0.9856474 * n, 360),
        Moon: mod(218.316 + 13.176396 * n, 360),
        Mercury: mod(252.2 + 4.092334 * n, 360),
        Venus: mod(181.98 + 1.602130 * n, 360),
        Mars: mod(355.45 + 0.524021 * n, 360),
        Jupiter: mod(34.35 + 0.083085 * n, 360),
        Saturn: mod(50.08 + 0.033444 * n, 360),
        Uranus: mod(313.5 + 0.011725 * n, 360),
        Neptune: mod(304.3 + 0.00598 * n, 360),
        Pluto: mod(238.95 + 0.00396 * n, 360)
      };
      return orbits[name] || 0;
    }

    function getHouseNumber(longitude, houses) {
      for (let i = 0; i < 12; i++) {
        const start = houses[i];
        const end = houses[(i + 1) % 12];
        if (start <= end) {
          if (longitude >= start && longitude < end) return i + 1;
        } else {
          if (longitude >= start || longitude < end) return i + 1;
        }
      }
      return 1;
    }

    function drawCircle(x, y, r, color, fill = false) {
      ctx.beginPath();
      ctx.arc(x, y, r, 0, 2 * Math.PI);
      ctx.strokeStyle = color;
      if (fill) ctx.fillStyle = color;
      ctx.stroke();
      if (fill) ctx.fill();
    }

    function writeText(text, x, y, color = 'white', size = 16, font = 'Arial') {
      ctx.font = `${size}px '${font}', sans-serif`;
      ctx.fillStyle = color;
      ctx.textAlign = 'center';
      ctx.fillText(text, x, y);
    }

    function drawChart(asc, mc, longitudes, houses) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.translate(0.5, 0.5);

      drawCircle(cx, cy, radius, '#0077b6');

      for (let i = 0; i < 12; i++) {
        const angle = degToRad(houses[i]) - Math.PI / 2;
        const x1 = cx + Math.cos(angle) * radius;
        const y1 = cy + Math.sin(angle) * radius;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(x1, y1);
        ctx.strokeStyle = '#005f86';
        ctx.stroke();
      }

      planets.forEach((p, i) => {
        const angle = degToRad(longitudes[i]) - Math.PI / 2;
        const x = cx + Math.cos(angle) * radius;
        const y = cy + Math.sin(angle) * radius;
        drawCircle(x, y, 7, '#222', true);
        writeText(p.symbol, x, y + 5, p.color, 16, 'Segoe UI Symbol');
      });

      for (let i = 0; i < 12; i++) {
        const deg = i * 30 + 15;
        const angle = degToRad(deg) - Math.PI / 2;
        const x = cx + Math.cos(angle) * (radius + 50);
        const y = cy + Math.sin(angle) * (radius + 50);
        const sign = zodiac[i];
        writeText(sign.symbol, x, y, sign.color, 24, 'Segoe UI Symbol');
      }

      const ascAngle = degToRad(asc) - Math.PI / 2;
      const mcAngle = degToRad(mc) - Math.PI / 2;
      writeText('â†‘', cx + Math.cos(ascAngle) * (radius + 20), cy + Math.sin(ascAngle) * (radius + 20), 'gold', 20);
      writeText('âŠ•', cx + Math.cos(mcAngle) * (radius + 20), cy + Math.sin(mcAngle) * (radius + 20), 'silver', 20);

      const aspects = [
        { name: 'Ø§Ù‚ØªØ±Ø§Ù†', angle: 0, orb: 8, color: 'gold' },
        { name: 'Ø³Ø¯Ø§Ø³ÙŠ', angle: 60, orb: 6, color: 'green' },
        { name: 'ØªØ«Ù„ÙŠØ«', angle: 120, orb: 8, color: 'blue' },
        { name: 'ØªØ±Ø¨ÙŠØ¹', angle: 90, orb: 8, color: 'red' },
        { name: 'ØªÙ‚Ø§Ø¨Ù„', angle: 180, orb: 10, color: 'purple' }
      ];

      for (let i = 0; i < longitudes.length; i++) {
        for (let j = i + 1; j < longitudes.length; j++) {
          const diff = mod(longitudes[j] - longitudes[i], 360);
          const minDiff = Math.min(diff, 360 - diff);
          for (const a of aspects) {
            if (Math.abs(minDiff - a.angle) < a.orb) {
              const x1 = cx + Math.cos(degToRad(longitudes[i]) - Math.PI/2) * radius;
              const y1 = cy + Math.sin(degToRad(longitudes[i]) - Math.PI/2) * radius;
              const x2 = cx + Math.cos(degToRad(longitudes[j]) - Math.PI/2) * radius;
              const y2 = cy + Math.sin(degToRad(longitudes[j]) - Math.PI/2) * radius;
              ctx.beginPath();
              ctx.moveTo(x1, y1);
              ctx.lineTo(x2, y2);
              ctx.strokeStyle = a.color;
              ctx.lineWidth = 2;
              ctx.stroke();
            }
          }
        }
      }
    }

    canvas.addEventListener('mousemove', function(e) {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left - cx;
      const y = e.clientY - rect.top - cy;
      const dist = Math.sqrt(x*x + y*y);
      if (dist < radius && dist > 50) {
        const angle = (Math.atan2(y, x) + Math.PI / 2 + 2 * Math.PI) % (2 * Math.PI);
        const deg = radToDeg(angle);
        const houseIndex = Math.floor(deg / 30);
        const houseNum = houseIndex + 1;
        tooltip.style.opacity = 1;
        tooltip.style.left = `${e.clientX}px`;
        tooltip.style.top = `${e.clientY - 10}px`;
        tooltip.innerHTML = `Ø¨ÙŠØª ${houseNum}`;
      } else {
        tooltip.style.opacity = 0;
      }
    });

    function saveReport(type) {
      const text = `ØªÙ‚Ø±ÙŠØ± ÙÙ„ÙƒÙŠ\n${document.getElementById('analysisContent').innerText}`;
      if (type === 'txt') {
        const blob = new Blob([text], { type: 'text/plain' });
        const link = document.createElement('a');
        link.download = 'mawled-report.txt';
        link.href = URL.createObjectURL(blob);
        link.click();
      } else {
        const pdf = `%PDF-1.4\n1 0 obj<</Type/Catalog/Pages 2 0 R>>endobj\n2 0 obj<</Type/Pages/Kids[3 0 R]/Count 1>>endobj\n3 0 obj<</Type/Page/MediaBox[0 0 600 800]/Contents 4 0 R/Resources<</Font<</F1 5 0 R>>>>>>endobj\n4 0 obj<</Length 100>>stream\nBT /F1 12 Tf 50 750 Td (ØªÙ‚Ø±ÙŠØ± ÙÙ„ÙƒÙŠ) Tj\nET\nendstream\nendobj\n5 0 obj<</Type/Font/Subtype/Type1/BaseFont/Helvetica>>endobj\nxref 0 6\n0000000000 65535 f\n0000000010 00000 n\n0000000070 00000 n\n0000000120 00000 n\n0000000250 00000 n\n0000000400 00000 n\ntrailer<</Size 6/Root 1 0 R>>\nstartxref\n${text.length + 600}\n%%EOF`;
        const blob = new Blob([pdf], { type: 'application/pdf' });
        const link = document.createElement('a');
        link.download = 'mawled-report.pdf';
        link.href = URL.createObjectURL(blob);
        link.click();
      }
    }

    function printReport() {
      const w = window.open();
      w.document.write(`
        <html><head><title>ØªÙ‚Ø±ÙŠØ± ÙÙ„ÙƒÙŠ</title></head><body>
          <h1>ØªÙ‚Ø±ÙŠØ± ÙÙ„ÙƒÙŠ</h1>
          <img src="${canvas.toDataURL()}" width="600"><br><br>
          <h2>Ø§Ù„ØªØ­Ù„ÙŠÙ„</h2>
          ${document.getElementById('analysisContent').innerHTML}
        </body></html>
      `);
      w.document.close();
      w.onload = () => w.print();
    }

    // --- Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø¨ÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ ---
    function generateLiteraryAnalysis(data) {
      const { longitudes, houses, asc, mc } = data;
      const sunSign = zodiac[Math.floor(longitudes[0] / 30)];
      const moonSign = zodiac[Math.floor(longitudes[1] / 30)];
      const ascSign = zodiac[Math.floor(asc / 30)];
      const mcSign = zodiac[Math.floor(mc / 30)];

      let analysis = `
        <p>ÙÙŠ ÙƒÙˆÙ†Ùƒ Ø§Ù„ÙÙ„ÙƒÙŠØŒ ØªØ¬ØªÙ…Ø¹ Ù‚ÙˆÙ‰ Ø¹Ø¸ÙŠÙ…Ø©: ÙØ£Ù†Øª ØªØ­Ù…Ù„ ÙÙŠ Ø±ÙˆØ­Ùƒ Ù†Ø§Ø± Ø§Ù„Ø­Ù…Ù„ Ø§Ù„ØªÙŠ Ù„Ø§ ØªÙ†Ø·ÙØ¦ØŒ ÙˆØªØ­Ù…Ù„ Ø¹Ù„Ù‰ ÙƒØªÙÙŠÙƒ Ø¬ÙØ¯Ù‘ Ø§Ù„Ø¬Ø¯ÙŠ Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠÙ„ÙŠÙ†. Ù‡Ø°Ø§ Ø§Ù„ØªÙ†Ø§Ù‚Ø¶ Ø§Ù„Ù…Ù‚Ø¯Ø³ Ù‡Ùˆ Ù…ØµØ¯Ø± Ù‚ÙˆØªÙƒ.</p>
        
        <h3>ğŸŒ Ø§Ù„Ø´Ù…Ø³ ÙÙŠ ${sunSign.name}</h3>
        <p>Ø§Ù„Ø´Ù…Ø³ ÙÙŠ ${sunSign.name} ØªÙ…Ù†Ø­Ùƒ Ø±Ø¤ÙŠØ© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ù‡Ø¯ÙØŒ ÙˆØµØ¨Ø±Ù‹Ø§ Ù„Ø§ ÙŠÙ†Ø¶Ø¨. Ø£Ù†Øª Ù„Ø§ ØªØ¨Ù†ÙŠ Ù‚ØµÙˆØ±Ù‹Ø§ Ù…Ù† Ø±Ù…Ø§Ù„ØŒ Ø¨Ù„ Ù…Ù† Ø­Ø¬Ø§Ø±Ø©. Ø·Ù…ÙˆØ­Ùƒ Ù„ÙŠØ³ Ù„Ù„Ø´Ù‡Ø±Ø©ØŒ Ø¨Ù„ Ù„Ù„Ø®Ù„ÙˆØ¯.</p>
        
        <h3>ğŸŒ™ Ø§Ù„Ù‚Ù…Ø± ÙÙŠ ${moonSign.name}</h3>
        <p>Ù„ÙƒÙ† Ø¯Ø§Ø®Ù„ÙƒØŒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø¨Ø·Ù„ØŒ ÙŠØ³ÙƒÙ† Ø·ÙÙ„ Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø°ÙŠ ÙŠØ±ÙŠØ¯ Ø£Ù† ÙŠØ±ÙƒØ¶ØŒ ÙŠØµØ±Ø®ØŒ ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯ ÙƒÙ„ Ù„Ø­Ø¸Ø©. Ù„Ø§ ØªÙƒØ¨Øª Ù‡Ø°Ø§ Ø§Ù„Ø·ÙÙ„ØŒ Ø¨Ù„ Ø§Ø¬Ø¹Ù„Ù‡ Ø´Ø±ÙŠÙƒÙƒ ÙÙŠ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©.</p>
        
        <h3>â†‘ Ø§Ù„ØµØ§Ø¹Ø¯ ÙÙŠ ${ascSign.name}</h3>
        <p>Ø§Ù„Ø¹Ø§Ù„Ù… ÙŠØ±Ø§Ùƒ Ùƒ${ascSign.name} â€” ØºØ§Ù…Ø¶ØŒ Ø¹Ù…ÙŠÙ‚ØŒ Ù„Ø§ ÙŠÙÙ‚Ø±Ø£ Ø¨Ø³Ù‡ÙˆÙ„Ø©. Ù‡Ø°Ø§ Ø¯Ø±Ø¹Ùƒ ÙˆØ³Ù„Ø§Ø­Ùƒ. Ù„Ø§ ØªÙƒØ´Ù Ø£Ø³Ø±Ø§Ø±Ùƒ Ø¥Ù„Ø§ Ù„Ù…Ù† ÙŠØ³ØªØ­Ù‚.</p>
        
        <h3>âŠ• Ø§Ù„Ù‚Ù…Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© ÙÙŠ ${mcSign.name}</h3>
        <p>Ù…ØµÙŠØ±Ùƒ Ø§Ù„Ù…Ù‡Ù†ÙŠ Ù…Ø±ØªØ¨Ø· Ø¨Ø¨Ù†Ø§Ø¡ Ø¥Ø±Ø«. Ø£Ù†Øª Ù„Ø³Øª Ù…ÙˆØ¸ÙÙ‹Ø§ØŒ Ø¨Ù„ Ù…Ø¤Ø³Ø³. Ø­ØªÙ‰ Ù„Ùˆ Ø¹Ù…Ù„Øª ÙÙŠ ÙˆØ¸ÙŠÙØ©ØŒ Ø³ØªØ¨Ù†ÙŠ Ù…Ù†Ù‡Ø§ Ù…Ù…Ù„ÙƒØ©.</p>
      `;

      // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ Ø§Ù„Ø£Ø®Ø±Ù‰
      if (longitudes[4] > 300 || longitudes[4] < 30) { // Ø§Ù„Ù…Ø±ÙŠØ® ÙÙŠ Ø§Ù„Ø­ÙˆØª Ø£Ùˆ Ø§Ù„Ø­Ù…Ù„
        analysis += `<h3>â™‚ Ø§Ù„Ù…Ø±ÙŠØ®</h3><p>Ø·Ø§Ù‚ØªÙƒ Ù†Ø¨ÙŠÙ„Ø©ØŒ ØªÙÙˆØ¬ÙÙ‘Ù‡ Ù„Ù„Ø¯ÙØ§Ø¹ Ø¹Ù† Ø§Ù„Ø¶Ø¹ÙØ§Ø¡ØŒ Ù„Ø§ Ù„Ù„Ù‡ÙŠÙ…Ù†Ø©.</p>`;
      }

      if (Math.abs(longitudes[0] - longitudes[9]) < 8) { // Ø§Ù‚ØªØ±Ø§Ù† Ø§Ù„Ø´Ù…Ø³ ÙˆØ¨Ù„ÙˆØªÙˆ
        analysis += `<h3>â˜‰ â™‡ Ø§Ù‚ØªØ±Ø§Ù† Ø§Ù„Ø´Ù…Ø³ ÙˆØ¨Ù„ÙˆØªÙˆ</h3><p>Ù„Ø¯ÙŠÙƒ Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ„Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø±Ù…Ø§Ø¯. ÙƒÙ„ Ù…Ø±Ø© ØªÙÙ‡Ø²Ù…ØŒ ØªØ¹ÙˆØ¯ Ø£Ù‚ÙˆÙ‰ØŒ Ø£Ø¹Ù…Ù‚ØŒ ÙˆØ£ÙƒØ«Ø± Ø­ÙƒÙ…Ø©.</p>`;
      }

      analysis += `
        <h3>ğŸŒŒ Ø§Ù„Ø®Ù„Ø§ØµØ©</h3>
        <p>Ø£Ù†Øª Ù„Ø³Øª Ù…Ø¬Ø±Ø¯ Ø´Ø®ØµØŒ Ø¨Ù„ Ø¬Ø³Ø± Ø¨ÙŠÙ† Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„Ø³Ù…Ø§Ø¡. Ø§Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØªÙƒ Ù„Ø¨Ù†Ø§Ø¡ØŒ ÙˆÙ†Ø§Ø±Ùƒ Ù„Ø¥Ù„Ù‡Ø§Ù…. Ø§Ù„Ø¹Ø§Ù„Ù… ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ù† ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù…Ù‚ ÙˆØ§Ù„Ø´Ø¬Ø§Ø¹Ø© â€” ÙˆÙ‡Ø°Ø§ Ø£Ù†Øª.</p>
      `;

      return analysis;
    }

    function showPersonalityAnalysis() {
      if (!currentData) return;
      document.getElementById('personalityContent').innerHTML = generateLiteraryAnalysis(currentData);
      document.getElementById('analysisModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('analysisModal').style.display = 'none';
    }

    function generateChart() {
      const dateStr = document.getElementById('birthDate').value;
      const timeStr = document.getElementById('birthTime').value;
      const lat = parseFloat(document.getElementById('latitude').value);
      const lon = parseFloat(document.getElementById('longitude').value);

      if (!dateStr || !timeStr || isNaN(lat) || isNaN(lon)) {
        alert('Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
        return;
      }

      const dateTimeStr = `${dateStr}T${timeStr}`;
      const birthDate = new Date(dateTimeStr);
      if (isNaN(birthDate)) {
        alert('ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­');
        return;
      }

      const jd = julianDay(birthDate);
      const lst = localSiderealTime(jd, lon);
      const asc = calculateAscendant(lst, lat);
      const mc = calculateMC(lst);
      const houses = equalHouses(asc);
      const longitudes = planets.map(p => planetLong(p.eng, jd));

      drawChart(asc, mc, longitudes, houses);

      document.getElementById('infoPanel').innerHTML = `LST: ${lst.toFixed(1)}Â° | Ø§Ù„ØµØ§Ø¹Ø¯: ${asc.toFixed(1)}Â° | MC: ${mc.toFixed(1)}Â°`;

      const legend = document.getElementById('planetsLegend');
      legend.innerHTML = '';
      planets.forEach((p, i) => {
        const sign = zodiac[Math.floor(longitudes[i] / 30)];
        const house = getHouseNumber(longitudes[i], houses);
        const div = document.createElement('div');
        div.className = 'legend-item';
        div.style.color = p.color;
        div.innerHTML = `<span class="symbol">${p.symbol}</span> ${p.name} <small>(Ø§Ù„Ø¨ÙŠØª ${house})</small>`;
        legend.appendChild(div);
      });

      const planetsGuide = document.getElementById('planetsGuide');
      const signsGuide = document.getElementById('signsGuide');
      planetsGuide.innerHTML = '';
      signsGuide.innerHTML = '';

      planets.forEach(p => {
        const div = document.createElement('div');
        div.className = 'legend-row';
        div.innerHTML = `<span class="symbol">${p.symbol}</span> ${p.name}`;
        planetsGuide.appendChild(div);
      });

      zodiac.forEach(s => {
        const div = document.createElement('div');
        div.className = 'legend-row';
        div.innerHTML = `<span class="symbol" style="color:${s.color}">${s.symbol}</span> ${s.name}`;
        signsGuide.appendChild(div);
      });

      currentData = { longitudes, houses, asc, mc };
      document.getElementById('btnAnalysis').style.display = 'block';
    }

    window.onload = function () {
      document.getElementById('birthDate').value = '1969-02-20';
      document.getElementById('birthTime').value = '06:30';
      generateChart();
    };
  </script>
</body>
</html>